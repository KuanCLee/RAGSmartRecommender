{"version":3,"file":"index.js","sources":["../src/helpers/is/index.js","../src/helpers/createReactContext.js","../src/core/context/reactContext.js","../src/core/context/FakeScopeContext.js","../src/core/context/index.js","../src/core/Freeze.js","../src/core/Bridge/Context/fixContext.js","../src/core/Bridge/Context/ProviderBridge.js","../src/core/Bridge/Context/ConsumerWrapper.js","../src/core/Bridge/Context/ConsumerBridge.js","../src/core/Bridge/Suspense.js","../src/core/Bridge/ErrorBoundary.js","../src/core/Bridge/index.js","../src/core/lifecycles.js","../src/core/Keeper.js","../src/core/AliveScope.js","../src/core/withAliveScope.js","../src/helpers/saveScrollPosition.js","../src/core/KeepAlive.js"],"sourcesContent":["// 值类型判断 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\nexport const isRegExp = (val) => val instanceof RegExp\n// 值类型判断 -------------------------------------------------------------\n","// From https://github.com/jamiebuilds/create-react-context/blob/master/src/implementation.js\r\nimport React, { Component } from 'react'\r\nimport { random } from 'szfe-tools'\r\n\r\nconst MAX_SIGNED_31_BIT_INT = 1073741823\r\n\r\n// Inlined Object.is polyfill.\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is\r\nfunction objectIs(x, y) {}\r\n\r\nfunction createEventEmitter(value) {\r\n  let handlers = []\r\n  return {\r\n    on(handler) {\r\n      handlers.push(handler)\r\n    },\r\n\r\n    off(handler) {\r\n      handlers = handlers.filter((h) => h !== handler)\r\n    },\r\n\r\n    get() {\r\n      return value\r\n    },\r\n\r\n    set(newValue, changedBits) {\r\n      value = newValue\r\n      handlers.forEach((handler) => handler(value, changedBits))\r\n    },\r\n  }\r\n}\r\n\r\nfunction onlyChild(children) {\r\n  return Array.isArray(children) ? children[0] : children\r\n}\r\n\r\nfunction createReactContext(defaultValue, calculateChangedBits) {\r\n  const contextProp = '__create-react-context-' + random() + '__'\r\n\r\n  class Provider extends Component {\r\n    emitter = createEventEmitter(this.props.value)\r\n\r\n    getChildContext() {\r\n      return {\r\n        [contextProp]: this.emitter,\r\n      }\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps) {\r\n      if (this.props.value !== nextProps.value) {\r\n        let oldValue = this.props.value\r\n        let newValue = nextProps.value\r\n        let changedBits\r\n\r\n        if (objectIs(oldValue, newValue)) {\r\n          changedBits = 0 // No change\r\n        } else {\r\n          changedBits =\r\n            typeof calculateChangedBits === 'function'\r\n              ? calculateChangedBits(oldValue, newValue)\r\n              : MAX_SIGNED_31_BIT_INT\r\n\r\n          changedBits |= 0\r\n\r\n          if (changedBits !== 0) {\r\n            this.emitter.set(nextProps.value, changedBits)\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    render() {\r\n      return this.props.children\r\n    }\r\n  }\r\n\r\n  class Consumer extends Component {\r\n    observedBits\r\n\r\n    state = {\r\n      value: this.getValue(),\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps) {\r\n      let { observedBits } = nextProps\r\n      this.observedBits =\r\n        observedBits === undefined || observedBits === null\r\n          ? MAX_SIGNED_31_BIT_INT // Subscribe to all changes by default\r\n          : observedBits\r\n    }\r\n\r\n    componentDidMount() {\r\n      if (this.context[contextProp]) {\r\n        this.context[contextProp].on(this.onUpdate)\r\n      }\r\n      let { observedBits } = this.props\r\n      this.observedBits =\r\n        observedBits === undefined || observedBits === null\r\n          ? MAX_SIGNED_31_BIT_INT // Subscribe to all changes by default\r\n          : observedBits\r\n    }\r\n\r\n    componentWillUnmount() {\r\n      if (this.context[contextProp]) {\r\n        this.context[contextProp].off(this.onUpdate)\r\n      }\r\n    }\r\n\r\n    getValue() {\r\n      if (this.context[contextProp]) {\r\n        return this.context[contextProp].get()\r\n      } else {\r\n        return defaultValue\r\n      }\r\n    }\r\n\r\n    onUpdate = (newValue, changedBits) => {\r\n      const observedBits = this.observedBits | 0\r\n      if ((observedBits & changedBits) !== 0) {\r\n        this.setState({ value: this.getValue() })\r\n      }\r\n    }\r\n\r\n    render() {\r\n      return onlyChild(this.props.children)(this.state.value)\r\n    }\r\n  }\r\n\r\n  return {\r\n    Provider,\r\n    Consumer,\r\n  }\r\n}\r\n\r\nexport default React.createContext || createReactContext\r\n","import createContext from '../../helpers/createReactContext'\n\n// 整个 KeepAlive 功能的上下文，将 KeepAlive 的组件藏于其 Provider 中，保证其不会被卸载\nexport const aliveScopeContext = createContext()\nexport const {\n  Provider: AliveScopeProvider,\n  Consumer: AliveScopeConsumer,\n} = aliveScopeContext\n\n// KeepAlive 组件的上下文，实现缓存生命周期功能\nexport const aliveNodeContext = createContext()\nexport const {\n  Provider: AliveNodeProvider,\n  Consumer: AliveNodeConsumer,\n} = aliveNodeContext\n","import { Component, PureComponent } from 'react'\nimport { EventBus, run, debounce } from 'szfe-tools'\n\nexport const eventBus = new EventBus()\n\nexport class FakeScopeProvider extends Component {\n  static eventBus = eventBus\n  static currentContextValue = undefined\n\n  constructor(props) {\n    super(props)\n    FakeScopeProvider.currentContextValue = props.value\n  }\n\n  shouldComponentUpdate(nextProps) {\n    if (nextProps.value !== this.props.value) {\n      FakeScopeProvider.currentContextValue = nextProps.value\n      eventBus.emit('update', nextProps.value)\n    }\n\n    return (\n      nextProps.children !== this.props.children ||\n      nextProps.value !== this.props.value\n    )\n  }\n\n  render() {\n    const { children } = this.props\n    return children\n  }\n}\n\nexport class FakeScopeConsumer extends PureComponent {\n  state = {\n    context: FakeScopeProvider.currentContextValue,\n  }\n\n  constructor(props) {\n    super(props)\n    eventBus.on('update', this.updateListener)\n  }\n\n  updateListener = debounce((nextContextValue) => {\n    this.setState({\n      context: nextContextValue,\n    })\n  })\n\n  componentWillUnmount() {\n    eventBus.off('update', this.updateListener)\n  }\n\n  render() {\n    const { children } = this.props\n    const { context } = this.state\n    return run(children, undefined, context)\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, { useState, useContext, useEffect } from 'react'\nimport { run, debounce, isFunction } from 'szfe-tools'\n\nimport {\n  aliveScopeContext,\n  AliveScopeProvider as AliveScopeReactProvider,\n  AliveScopeConsumer as AliveScopeReactConsumer,\n  aliveNodeContext,\n  AliveNodeProvider,\n  AliveNodeConsumer,\n} from './reactContext'\nimport {\n  eventBus as fakeContextEventBus,\n  FakeScopeProvider,\n  FakeScopeConsumer,\n} from './FakeScopeContext'\n\nexport const useScopeContext = () => {\n  if (!isFunction(useContext)) {\n    return {}\n  }\n\n  const scopeReactContext = useContext(aliveScopeContext)\n\n  if (scopeReactContext) {\n    return scopeReactContext\n  }\n\n  const [context, setContext] = useState(FakeScopeProvider.currentContextValue)\n\n  useEffect(() => {\n    const updateListener = debounce(setContext)\n    fakeContextEventBus.on('update', updateListener)\n    return () => fakeContextEventBus.off('update', updateListener)\n  }, [])\n\n  return context\n}\n\nexport const AliveScopeProvider = ({ children, ...props }) => (\n  <AliveScopeReactProvider {...props}>\n    <FakeScopeProvider {...props}>{children}</FakeScopeProvider>\n  </AliveScopeReactProvider>\n)\nexport const AliveScopeConsumer = ({ children }) => (\n  <AliveScopeReactConsumer>\n    {(reactContext) =>\n      !!reactContext ? (\n        run(children, undefined, reactContext)\n      ) : (\n        <FakeScopeConsumer>{children}</FakeScopeConsumer>\n      )\n    }\n  </AliveScopeReactConsumer>\n)\nexport {\n  aliveScopeContext,\n  aliveNodeContext,\n  AliveNodeProvider,\n  AliveNodeConsumer,\n}\n","// Fork from react-freeze\r\n// https://github.com/software-mansion/react-freeze/blob/main/src/index.tsx\r\nimport React, { Component, Suspense, Fragment } from 'react'\r\n\r\n// function Suspender({ freeze, children }) {\r\n//   const promiseCache = useRef({}).current\r\n//   if (freeze && !promiseCache.promise) {\r\n//     promiseCache.promise = new Promise((resolve) => {\r\n//       promiseCache.resolve = resolve\r\n//     })\r\n//     throw promiseCache.promise\r\n//   } else if (freeze) {\r\n//     throw promiseCache.promise\r\n//   } else if (promiseCache.promise) {\r\n//     promiseCache.resolve()\r\n//     promiseCache.promise = undefined\r\n//   }\r\n\r\n//   return <Fragment>{children}</Fragment>\r\n// }\r\n\r\nclass Suspender extends Component {\r\n  promiseCache = {}\r\n  render() {\r\n    const { freeze, children } = this.props\r\n    const { promiseCache } = this\r\n\r\n    if (freeze && !promiseCache.promise) {\r\n      promiseCache.promise = new Promise((resolve) => {\r\n        promiseCache.resolve = resolve\r\n      })\r\n      throw promiseCache.promise\r\n    } else if (freeze) {\r\n      throw promiseCache.promise\r\n    } else if (promiseCache.promise) {\r\n      promiseCache.resolve()\r\n      promiseCache.promise = undefined\r\n    }\r\n\r\n    return <Fragment>{children}</Fragment>\r\n  }\r\n}\r\n\r\nexport default function Freeze({ freeze, children, placeholder = null }) {\r\n  return (\r\n    <Suspense fallback={placeholder}>\r\n      <Suspender freeze={freeze}>{children}</Suspender>\r\n    </Suspense>\r\n  )\r\n}","import React, { useContext, Fragment } from 'react'\nimport { run, get, isString, isFunction, memoize, EventBus, isExist } from 'szfe-tools'\n\nimport createReactContext from '../../../helpers/createReactContext'\nimport { aliveScopeContext, aliveNodeContext } from '../../context'\n\nexport const fixedContext = []\nexport const updateListenerCache = new Map()\nexport const eventBus = new EventBus()\n\nexport const fixContext = memoize((ctx) => {\n  if (!isExist(ctx)) {\n    return\n  }\n\n  // 排除 KeepAlive 功能的上下文\n  if ([aliveScopeContext, aliveNodeContext].includes(ctx)) {\n    return\n  }\n\n  // #259: 结合 use-context-selector 时，修复被删除的 Consumer\n  if (!isExist(ctx.Consumer)) {\n    function Consumer({ children }) {\n      const ctxValue = run(useContext, undefined, ctx)\n    \n      return <Fragment>{run(children, undefined, ctxValue)}</Fragment>\n    }\n    \n    // 重新声明 Consumer\n    ctx.Consumer = Consumer\n  }\n\n  fixedContext.push(ctx)\n  setTimeout(() => eventBus.emit('update'))\n})\n\nexport const createContext = (defaultValue, calculateChangedBits) => {\n  const ctx = createReactContext(defaultValue, calculateChangedBits)\n\n  fixContext(ctx)\n  return ctx\n}\n\nconst tryFixCtx = memoize((type) => {\n  // 尝试读取 Provider 或 Consumer 中的 context 静态属性\n  const ctx = get(type, '_context') || get(type, 'context') // 16.3.0 版本为 context，之后为 _context\n\n  // 判断是否为 ReactContext 类型\n  if (get(ctx, '$$typeof') === get(aliveScopeContext, '$$typeof')) {\n    fixContext(ctx)\n  }\n})\n\nconst override = (configs) => {\n  configs.forEach(([host, ...methods]) => {\n    methods.forEach((method) => {\n      if (\n        !isFunction(get(host, method)) ||\n        get(host, [method, '_overridden'])\n      ) {\n        return\n      }\n      const originMethod = host[method].bind(host)\n      host[method] = (type, ...args) => {\n        if (!isString(type)) {\n          tryFixCtx(type)\n        }\n        return originMethod(type, ...args)\n      }\n      host[method]._overridden = true\n    })\n  })\n}\n\n/**\n * 通过覆写 React.createElement 方法来探测 Provider 或 Consumer 的创建，并攫取其中 context 主动进行修复\n * TODO：同时兼容 React 17+，目前仅默认兼容 React.createElement 方法\n * React 17+ 为 require('react/jsx-runtime') 或 require('react/jsx-dev-runtime') 的 jsx、jsxs、jsxDEV 方法\n * 但由于无法动态 require，暂未想到方式同时兼容\n * 若需兼容 17+，目前手法为\n *\n * autoFixContext(\n *   [require('react/jsx-runtime'), 'jsx', 'jsxs', 'jsxDEV'],\n *   [require('react/jsx-dev-runtime'), 'jsx', 'jsxs', 'jsxDEV']\n * )\n *\n * Note: 需注意 16.2.x 及以下版本不支持此方法\n */\nexport const autoFixContext = (...configs) => {\n  try {\n    override(configs)\n  } catch (err) {\n    console.warn('activation override failed:', err)\n  }\n}\n\nautoFixContext([React, 'createElement'])\n","import React, { PureComponent } from 'react'\nimport { run, isUndefined } from 'szfe-tools'\n\nexport default class ProviderBridge extends PureComponent {\n  unmount = null\n  constructor(props) {\n    super(props)\n\n    const { value: ctxValues } = props\n\n    if (ctxValues.length === 0) {\n      this.state = {\n        ctxValue: null,\n      }\n\n      return\n    }\n\n    const [{ ctx, value, onUpdate }] = ctxValues\n\n    this.state = {\n      ctxValue: value,\n    }\n\n    this.unmount = onUpdate((value) => {\n      this.setState({\n        ctxValue: value,\n      })\n    })\n  }\n\n  componentWillUnmount() {\n    run(this.unmount)\n  }\n\n  // componentDidCatch(error) {\n  //   console.error('ProviderBridge Error', error)\n  // }\n\n  render() {\n    const { value: propCtxValues, children } = this.props\n    const ctxValues = propCtxValues.filter(Boolean)\n\n    if (ctxValues.length === 0) {\n      return children\n    }\n\n    const { ctxValue } = this.state\n    const [{ ctx }, ...restValues] = ctxValues\n    const { Provider } = ctx\n\n    const nextChildren = !isUndefined(ctxValue) ? (\n      <Provider value={ctxValue}>{children}</Provider>\n    ) : (\n      children\n    )\n\n    // 递归 ProviderBridge 修复多个上下文\n    // 此处未考虑待修复上下文顺序问题，按先来后到顺序处理，但理论上不应存在顺序问题\n    return restValues.length > 0 ? (\n      <ProviderBridge value={restValues}>{nextChildren}</ProviderBridge>\n    ) : (\n      nextChildren\n    )\n  }\n}\n","import { Component } from 'react'\nimport { run, get, isUndefined } from 'szfe-tools'\n\nimport { updateListenerCache } from './fixContext'\n\n// 在 KeepAlive 位置使用待修复上下文的 Consumer 探测可能存在的上下文关系\n// 若成功捕获上下文则保存其内容，用以后续 Keeper 中上下文的重建\nexport default class ConsumerWrapper extends Component {\n  updateListener = null\n  ctxInfo = null\n  constructor(props) {\n    super(props)\n\n    const { value, ctx, id } = props\n    if (isUndefined(value)) {\n      return\n    }\n\n    // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n    // componentWillUnmount 中保留了已生成的更新监听器\n    // 此处重新挂载后恢复与对应 Keeper 中 ProviderBridge 的联系\n    this.updateListener = get(updateListenerCache.get(ctx), id, new Map())\n    run(this.updateListener, 'forEach', (fn) => fn(value))\n    this.ctxInfo = {\n      ctx,\n      value,\n      // 注册上下文更新的监听，保证上下文更新时 Keeper 中 ProviderBridge 内容的同步\n      onUpdate: (updator) => {\n        this.updateListener.set(updator, updator)\n\n        // 返回更新监听器的注销方法\n        return () => this.updateListener.delete(updator)\n      },\n    }\n  }\n\n  componentWillUnmount() {\n    const { value, ctx, id } = this.props\n    if (isUndefined(value)) {\n      return\n    }\n\n    // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n    // 此处保留其中已生成的更新监听器，用以在重新挂载后保持与对应 Keeper 中 ProviderBridge 的联系\n    updateListenerCache.set(ctx, {\n      ...get(updateListenerCache.get(ctx), undefined, {}),\n      [id]: this.updateListener,\n    })\n  }\n\n  // 利用 shouldComponentUpdate 尽早将上下文更新的咨询通知到对应 Keeper 中 ProviderBridge\n  // TODO: 改用 componentWillReceiveProps 更早地进行更新，需注意与 getDerivedStateFromProps 新生命周期的兼容及可能存在的死循环问题\n  shouldComponentUpdate({ value }) {\n    const { value: prevValue } = this.props\n    const shouldUpdate = prevValue !== value\n\n    if (shouldUpdate) {\n      run(this.updateListener, 'forEach', (fn) => fn(value))\n    }\n\n    return true\n  }\n\n  render() {\n    const { value, renderWrapper, renderContent, id } = this.props\n\n    return renderWrapper((ctx$$) =>\n      renderContent(isUndefined(value) ? ctx$$ : [...ctx$$, this.ctxInfo])\n    )\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, {\n  PureComponent,\n  useContext,\n  useRef,\n  useEffect,\n  useState,\n} from 'react'\nimport { run, get, nextTick, isUndefined, isFunction, isExist } from 'szfe-tools'\n\nimport ConsumerWrapper from './ConsumerWrapper'\nimport { fixedContext, eventBus, updateListenerCache } from './fixContext'\n\nconst fixedContextSnapshot = {}\n\n// 对 ConsumerWrapper 的递归结构，会在 devtool 中生成较深的嵌套结构，可用 hooks 消除嵌套结构\nclass RecursiveConsumerBridge extends PureComponent {\n  constructor(props) {\n    super(props)\n    const { id } = props\n\n    if (!fixedContextSnapshot[id]) {\n      fixedContextSnapshot[id] = [...fixedContext].filter(ctx => isExist(ctx.Consumer))\n    }\n  }\n\n  renderWrapper = (renderChildren) => {\n    const { id } = this.props\n\n    const renderWrapper = fixedContextSnapshot[id].reduce(\n      (render, ctx) => {\n        const { Consumer } = ctx\n\n        const renderWrapper = (renderContent) => (\n          <Consumer>\n            {(value) => (\n              <ConsumerWrapper\n                {...{\n                  value,\n                  ctx,\n                  renderWrapper: render,\n                  renderContent,\n                  id,\n                }}\n              />\n            )}\n          </Consumer>\n        )\n\n        return renderWrapper\n      },\n      (renderContent) => renderContent([])\n    )\n\n    return renderWrapper(renderChildren)\n  }\n\n  render() {\n    const { children: renderChildren } = this.props\n\n    return this.renderWrapper(renderChildren)\n  }\n}\n\n// 若支持 Hooks，就不需要递归了，相关实现解释可参考 ConsumerWrapper\n// function HooksConsumerBridge({ children: renderChildren, id }) {\n//   const [, setRenderKey] = useState(Math.random)\n\n//   useEffect(() => {\n//     // 渲染时若 fixedContext 列表更新，则需强制刷新\n//     const updateListener = () => setRenderKey(Math.random)\n//     eventBus.on('update', updateListener)\n//     return () => {\n//       eventBus.off('update', updateListener)\n//     }\n//   }, [])\n\n//   const context$$ = fixedContext\n//     .map((ctx) => {\n//       const value = useContext(ctx)\n//       const prevValueRef = useRef(value)\n//       const { current: updateListener } = useRef(\n//         get(updateListenerCache.get(ctx), id, new Map())\n//       )\n\n//       // 尽可能早地进行更新\n//       if (prevValueRef.current !== value) {\n//         nextTick(() => run(updateListener, 'forEach', (fn) => fn(value)))\n//       }\n//       prevValueRef.current = value\n\n//       useEffect(() => {\n//         return () => {\n//           if (isUndefined(value)) {\n//             return\n//           }\n\n//           updateListenerCache.set(ctx, {\n//             ...get(updateListenerCache.get(ctx), undefined, {}),\n//             [id]: updateListener,\n//           })\n//         }\n//       }, [])\n\n//       return {\n//         ctx,\n//         value,\n//         onUpdate: (fn) => {\n//           updateListener.set(fn, fn)\n\n//           return () => updateListener.delete(fn)\n//         },\n//       }\n//     })\n//     .filter(({ value }) => !isUndefined(value))\n\n//   return renderChildren(context$$)\n// }\n\n// fix #99\n// const ConsumerBridge = [useContext, useRef, useEffect].every(isFunction)\n//   ? HooksConsumerBridge\n//   : RecursiveConsumerBridge\n// fix #99\nexport default RecursiveConsumerBridge\n","import React, { lazy, Suspense, Component, Fragment } from 'react'\nimport { run, isUndefined, isFunction } from 'szfe-tools'\n\n// 兼容性检测\nconst isSupported = isFunction(lazy) && !isUndefined(Suspense)\nconst SusNotSupported = ({ children }) => run(children)\n\nconst Lazy = isSupported ? lazy(() => new Promise(() => null)) : () => null\n\nclass FallbackListener extends Component {\n  componentDidMount() {\n    run(this.props, 'onStart')\n  }\n\n  componentWillUnmount() {\n    run(this.props, 'onEnd')\n  }\n\n  render() {\n    return null\n  }\n}\n\nfunction SuspenseBridge({ children, sus$$ }) {\n  return (\n    // 捕获 Keeper 内部可能存在的 lazy，并触发对应 KeepAlive 位置上的 LazyBridge\n    <Suspense\n      fallback={\n        <FallbackListener\n          onStart={sus$$.onSuspenseStart}\n          onEnd={sus$$.onSuspenseEnd}\n        />\n      }\n    >\n      {children}\n    </Suspense>\n  )\n}\n\nexport const LazyBridge = isSupported\n  ? class LazyBridge extends Component {\n      state = {\n        suspense: false,\n      }\n\n      onSuspenseStart = () => {\n        this.setState({\n          suspense: true,\n        })\n      }\n\n      onSuspenseEnd = () => {\n        this.setState({\n          suspense: false,\n        })\n      }\n\n      sus$$ = {\n        onSuspenseStart: this.onSuspenseStart,\n        onSuspenseEnd: this.onSuspenseEnd,\n      }\n\n      render() {\n        const { children } = this.props\n\n        return (\n          <Fragment>\n            {run(children, undefined, this.sus$$)}\n            {/* 渲染 Lazy 以触发 KeepAlive 所处位置外部可能存在的 Suspense */}\n            {this.state.suspense && <Lazy />}\n          </Fragment>\n        )\n      }\n    }\n  : SusNotSupported\n\nexport default isSupported ? SuspenseBridge : SusNotSupported\n","import { Component } from 'react'\nimport { run } from 'szfe-tools'\n\nexport default class ErrorBoundaryBridge extends Component {\n  // Error Boundary 透传至对应 KeepAlive 实例位置\n  static getDerivedStateFromError = () => null\n  componentDidCatch(error) {\n    const { error$$: throwError } = this.props\n\n    run(throwError, undefined, error, () => {\n      run(throwError, undefined, null)\n    })\n  }\n\n  render() {\n    return this.props.children\n  }\n}\n\nexport class ErrorThrower extends Component {\n  state = {\n    error: null,\n  }\n\n  throwError = (error, cb) => this.setState({ error }, cb)\n  render() {\n    if (this.state.error) {\n      throw this.state.error\n    }\n\n    return run(this.props.children, undefined, this.throwError)\n  }\n}\n","import React from 'react'\nimport { run } from 'szfe-tools'\n\nimport { ProviderBridge, ConsumerBridge } from './Context'\nimport SuspenseBridge, { LazyBridge } from './Suspense'\nimport ErrorBoundaryBridge, { ErrorThrower } from './ErrorBoundary'\n\n// 用于 Keeper 中，实现 Keeper 向外或向内的桥接代理\nexport default function Bridge({ id, children, bridgeProps }) {\n  const { sus$$, ctx$$, error$$ } = bridgeProps\n\n  return (\n    /* 由内向外透传 componentDidCatch 捕获的 error */\n    <ErrorBoundaryBridge error$$={error$$}>\n      {/* 由内向外透传 lazy 行为 */}\n      <SuspenseBridge sus$$={sus$$}>\n        {/* 由外向内透传可能存在的 Consumer 数据 */}\n        <ProviderBridge id={id} value={ctx$$}>\n          {children}\n        </ProviderBridge>\n      </SuspenseBridge>\n    </ErrorBoundaryBridge>\n  )\n}\n\n// 用于 KeepAlive 中，实现 KeepAlive 向外或向内的桥接代理\nexport function Acceptor({ id, children }) {\n  return (\n    /* 由内向外透传 componentDidCatch 捕获的 error */\n    <ErrorThrower>\n      {(error$$) => (\n        /* 由内向外透传 lazy 行为 */\n        <LazyBridge>\n          {(sus$$) => (\n            /* 由外向内透传可能被捕获的 Provider 数据 */\n            <ConsumerBridge id={id}>\n              {(ctx$$) =>\n                run(children, undefined, {\n                  bridgeProps: {\n                    sus$$,\n                    ctx$$,\n                    error$$,\n                  },\n                })\n              }\n            </ConsumerBridge>\n          )}\n        </LazyBridge>\n      )}\n    </ErrorThrower>\n  )\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, {\n  Component,\n  forwardRef,\n  useEffect,\n  useRef,\n  useContext,\n} from 'react'\nimport hoistStatics from 'hoist-non-react-statics'\nimport {\n  get,\n  run,\n  nextTick,\n  isObject,\n  isFunction,\n  isUndefined,\n} from 'szfe-tools'\n\nimport { AliveNodeConsumer, aliveNodeContext } from './context'\n\nexport const LIFECYCLE_ACTIVATE = 'componentDidActivate'\nexport const LIFECYCLE_UNACTIVATE = 'componentWillUnactivate'\n\nexport const withActivation = (WrappedComponent) => {\n  class HOC extends Component {\n    drop = null\n\n    componentWillUnmount() {\n      run(this.drop)\n    }\n\n    render() {\n      const { forwardedRef, ...props } = this.props\n\n      return (\n        <AliveNodeConsumer>\n          {({ attach } = {}) => (\n            <WrappedComponent\n              ref={(ref) => {\n                if (\n                  [LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].every(\n                    (lifecycleName) => !isFunction(get(ref, lifecycleName))\n                  )\n                ) {\n                  return\n                }\n                this.drop = run(attach, undefined, ref)\n\n                // 以下保持 ref 功能\n                if (isUndefined(forwardedRef)) {\n                  return\n                }\n\n                if (isObject(forwardedRef) && 'current' in forwardedRef) {\n                  forwardedRef.current = ref\n                  return\n                }\n\n                run(forwardedRef, undefined, ref)\n              }}\n              {...props}\n            />\n          )}\n        </AliveNodeConsumer>\n      )\n    }\n  }\n\n  // 由于 KeepAlive 内组件渲染与实际内容落后一个节拍\n  // 将导致真实节点的 componentDidMount 无法及时获取到 KeepAlive 中内容的 ref 值\n  // 此处对使用了 withActivation HOC 的组件 componentDidMount 做 nextTick 延时处理\n  // 修复上述问题\n\n  if (isFunction(WrappedComponent.prototype.componentDidMount)) {\n    WrappedComponent.prototype._componentDidMount =\n      WrappedComponent.prototype.componentDidMount\n    WrappedComponent.prototype.componentDidMount = function componentDidMount() {\n      nextTick(() => WrappedComponent.prototype._componentDidMount.call(this))\n    }\n  }\n\n  if (isFunction(forwardRef)) {\n    const ForwardedRefHOC = forwardRef((props, ref) => (\n      <HOC {...props} forwardedRef={ref} />\n    ))\n\n    return hoistStatics(ForwardedRefHOC, WrappedComponent)\n  } else {\n    return hoistStatics(HOC, WrappedComponent)\n  }\n}\n\nconst useActivation = (funcName, func) => {\n  // 兼容性判断\n  if ([useRef, useContext, useEffect].some((fn) => !isFunction(fn))) {\n    return\n  }\n\n  const ctxValue = useContext(aliveNodeContext)\n\n  // 未处于 KeepAlive 中\n  if (!ctxValue) {\n    return\n  }\n\n  const { current: ref } = useRef({})\n  const { attach } = ctxValue\n\n  ref[funcName] = func\n  ref.drop = attach(ref)\n\n  useEffect(() => {\n    return () => run(ref.drop)\n  }, [])\n}\n\nexport const useActivate = useActivation.bind(null, LIFECYCLE_ACTIVATE)\nexport const useUnactivate = useActivation.bind(null, LIFECYCLE_UNACTIVATE)\n","import React, { PureComponent, Suspense } from 'react'\nimport { flushSync } from 'react-dom'\nimport { get, run, nextTick, EventBus } from 'szfe-tools'\n\nimport ReactFreeze from './Freeze'\nimport Bridge from './Bridge'\nimport { AliveNodeProvider } from './context'\nimport { LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE } from './lifecycles'\n\nconst Freeze = !!Suspense ? ReactFreeze : ({ children }) => children\n\nexport default class Keeper extends PureComponent {\n  eventBus = new EventBus()\n  listeners = new Map()\n  wrapper = null\n\n  constructor(props, ...rest) {\n    super(props, ...rest)\n\n    this.state = {\n      children: props.children,\n      bridgeProps: props.bridgeProps,\n      key: Math.random(),\n      freeze: false,\n    }\n  }\n\n  cache = undefined\n  componentDidMount() {\n    const { store, id } = this.props\n    const listeners = this.listeners\n    const node = this.wrapper\n\n    // 已存在检测，防止意外现象\n    if (store.has(id)) {\n      return\n    }\n\n    let nodes\n    try {\n      nodes = [...node.children]\n    } catch (e) {\n      nodes = [node.children]\n    }\n\n    this.cache = {\n      listeners,\n      aliveNodesId: [],\n      inited: false,\n      cached: false,\n      wrapper: node,\n      nodes,\n      [LIFECYCLE_ACTIVATE]: () => this[LIFECYCLE_ACTIVATE](),\n      [LIFECYCLE_UNACTIVATE]: () => this[LIFECYCLE_UNACTIVATE](),\n    }\n\n    store.set(id, this.cache)\n  }\n\n  unmounted = false\n  safeSetState = (nextState, callback) => {\n    // fix #170\n    if (this.unmounted) {\n      return\n    }\n    this.setState(nextState, callback)\n  }\n  componentWillUnmount() {\n    const { store, keepers, id } = this.props\n    // 卸载前尝试归位 DOM 节点\n    try {\n      const cache = store.get(id)\n      cache.nodes.forEach((node) => {\n        cache.wrapper.appendChild(node)\n      })\n    } catch (error) {\n      // console.error(error) // do nothing\n    }\n    store.delete(id)\n    keepers.delete(id)\n    this.unmounted = true\n  }\n\n  freezeTimeout = null;\n  [LIFECYCLE_ACTIVATE]() {\n    clearTimeout(this.freezeTimeout)\n    // 激活后，立即解冻\n    this.safeSetState({\n      freeze: false,\n    })\n    this.eventBus.emit(LIFECYCLE_ACTIVATE)\n    this.listeners.forEach((listener) => run(listener, [LIFECYCLE_ACTIVATE]))\n  }\n\n  [LIFECYCLE_UNACTIVATE]() {\n    this.eventBus.emit(LIFECYCLE_UNACTIVATE)\n    const listeners = [...this.listeners]\n\n    listeners\n      .reverse()\n      .forEach(([, listener]) => run(listener, [LIFECYCLE_UNACTIVATE]))\n\n    // 缓存后，延迟冻结，保证各项后续处理得以进行，如关闭弹窗等\n    clearTimeout(this.freezeTimeout)\n    this.freezeTimeout = setTimeout(() => {\n      flushSync(() => {\n        this.safeSetState({\n          freeze: true,\n        })\n      })\n    }, 1000)\n  }\n\n  // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n  // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n  // // 对应 KeepAlive 处 update 也注释起来不使用\n  // // 组件更新后，更新 DOM 节点列表状态\n  // componentDidUpdate() {\n  //   const { store, id } = this.props\n  //   const node = this.wrapper\n  //   if (get(node, 'children.length') > 0) {\n  //     store[id].nodes = [...node.children]\n  //   }\n\n  //   console.log(store[id].nodes)\n  // }\n\n  // 生命周期绑定\n  attach = (ref) => {\n    const listeners = this.listeners\n\n    if (!ref) {\n      return () => null\n    }\n\n    if (ref.isKeepAlive) {\n      nextTick(() => {\n        const { id, store } = this.props\n        const cache = store.get(id)\n        cache.aliveNodesId = new Set([...cache.aliveNodesId, ref.id])\n      })\n    }\n\n    listeners.set(ref, {\n      [LIFECYCLE_ACTIVATE]: () => run(ref, LIFECYCLE_ACTIVATE),\n      [LIFECYCLE_UNACTIVATE]: () => run(ref, LIFECYCLE_UNACTIVATE),\n    })\n\n    // 返回 listenerRemover 用以在对应组件卸载时解除监听\n    return () => {\n      listeners.delete(ref)\n    }\n  }\n\n  // 静态化节点上下文内容，防止重复渲染\n  contextValue = {\n    id: this.props.id,\n    attach: this.attach,\n  }\n\n  drop = ({ delay = 1200, refreshIfDropFailed = true } = {}) =>\n    new Promise((resolve) => {\n      let timeout\n      const { scope, id } = this.props\n      const drop = () => {\n        clearTimeout(timeout)\n        this.eventBus.off(LIFECYCLE_UNACTIVATE, drop)\n        // 用在多层 KeepAlive 同时触发 drop 时，避免触发深层 KeepAlive 节点的缓存生命周期\n        this.cache.willDrop = true\n        scope.nodes.delete(id)\n        scope.helpers = { ...scope.helpers }\n        scope.smartForceUpdate(() => resolve(true))\n      }\n\n      const canDrop = get(this.cache, 'cached') || get(this.cache, 'willDrop')\n      if (!canDrop) {\n        this.eventBus.on(LIFECYCLE_UNACTIVATE, drop)\n        timeout = setTimeout(() => {\n          this.eventBus.off(LIFECYCLE_UNACTIVATE, drop)\n          if (refreshIfDropFailed) {\n            this.refresh().then((result) => resolve(result))\n          } else {\n            resolve(false)\n          }\n        }, delay)\n        return\n      }\n\n      drop()\n    })\n\n  refresh = () =>\n    new Promise((resolve) => {\n      const canRefresh = !get(this.cache, 'cached')\n      if (!canRefresh) {\n        resolve(false)\n      }\n      this.safeSetState(\n        {\n          key: Math.random(),\n        },\n        () => resolve(true)\n      )\n    })\n\n  render() {\n    const { id, autoFreeze = true, contentProps = {}, ...props } = this.props\n    const { children, bridgeProps, key, freeze } = this.state\n\n    return (\n      <Freeze freeze={autoFreeze && freeze}>\n        <div\n          ref={(node) => {\n            this.wrapper = node\n          }}\n        >\n          <div\n            {...contentProps}\n            key='keeper-container'\n            nodeKeyIgnore\n            className={`ka-content ${contentProps.className || ''}`}\n          >\n            <Bridge id={id} bridgeProps={bridgeProps}>\n              <AliveNodeProvider value={this.contextValue}>\n                {React.Children.map(children, (child, idx) =>\n                  React.cloneElement(child, {\n                    key: `${child.key || ''}:${key}:${idx}`,\n                  })\n                )}\n              </AliveNodeProvider>\n            </Bridge>\n          </div>\n        </div>\n      </Freeze>\n    )\n  }\n}\n","import React, { Component } from 'react'\nimport { get, run, flatten, debounce, globalThis as root } from 'szfe-tools'\n\nimport { isRegExp } from '../helpers/is'\nimport { AliveScopeProvider } from './context'\nimport Keeper from './Keeper'\n\nconst HANDLE_TYPE_DROP = 'drop'\nconst HANDLE_TYPE_REFRESH = 'refresh'\n\nexport default class AliveScope extends Component {\n  store = new Map()\n  nodes = new Map()\n  keepers = new Map()\n\n  debouncedForceUpdate = debounce((cb) => this.forceUpdate(cb))\n  updateCallbackList = []\n  smartForceUpdate = (cb) => {\n    this.updateCallbackList.push(cb)\n    this.debouncedForceUpdate(() => {\n      this.updateCallbackList.forEach((cb) => run(cb))\n      this.updateCallbackList = []\n    })\n  }\n  update = (id, params) =>\n    new Promise((resolve) => {\n      const keeper = this.keepers.get(id)\n      const isNew = !keeper\n      const now = Date.now()\n      const node = this.nodes.get(id) || null\n      this.nodes.set(id, {\n        id,\n        createTime: now,\n        updateTime: now,\n        ...node,\n        ...params,\n      })\n\n      if (isNew) {\n        this.helpers = { ...this.helpers }\n\n        this.forceUpdate(resolve)\n      } else {\n        const { children, bridgeProps } = params\n        keeper.setState({ children, bridgeProps }, resolve)\n      }\n    })\n\n  keep = (id, params) =>\n    new Promise((resolve) => {\n      this.update(id, {\n        id,\n        ...params,\n      }).then(() => {\n        resolve(this.store.get(id))\n      })\n    })\n\n  getCachingNodesByName = (name) =>\n    this.getCachingNodes().filter((node) =>\n      isRegExp(name) ? name.test(node.name) : node.name === name\n    )\n\n  getScopeIds = (ids) => {\n    // 递归采集 scope alive nodes id\n    const getCachingNodesId = (id) => {\n      const aliveNodesId = get(this.getCache(id), 'aliveNodesId', [])\n\n      if (aliveNodesId.size > 0) {\n        return [id, [...aliveNodesId].map(getCachingNodesId)]\n      }\n\n      return [id, ...aliveNodesId]\n    }\n\n    return flatten(ids.map((id) => getCachingNodesId(id)))\n  }\n\n  dropById = (id, ...rest) => this.handleNodes([id], HANDLE_TYPE_DROP, ...rest)\n  dropScopeByIds = (ids, ...rest) =>\n    this.handleNodes(this.getScopeIds(ids), HANDLE_TYPE_DROP, ...rest)\n\n  drop = (name, ...rest) =>\n    this.handleNodes(\n      this.getCachingNodesByName(name).map((node) => node.id),\n      HANDLE_TYPE_DROP,\n      ...rest\n    )\n\n  dropScope = (name, ...rest) =>\n    this.dropScopeByIds(\n      this.getCachingNodesByName(name).map(({ id }) => id),\n      ...rest\n    )\n\n  refreshById = (id, ...rest) =>\n    this.handleNodes([id], HANDLE_TYPE_REFRESH, ...rest)\n  refreshScopeByIds = (ids, ...rest) =>\n    this.handleNodes(this.getScopeIds(ids), HANDLE_TYPE_REFRESH, ...rest)\n\n  refresh = (name, ...rest) =>\n    this.handleNodes(\n      this.getCachingNodesByName(name).map((node) => node.id),\n      HANDLE_TYPE_REFRESH,\n      ...rest\n    )\n\n  refreshScope = (name, ...rest) =>\n    this.refreshScopeByIds(\n      this.getCachingNodesByName(name).map(({ id }) => id),\n      ...rest\n    )\n\n  handleNodes = (nodesId, type = HANDLE_TYPE_DROP, ...rest) =>\n    new Promise((resolve) => {\n      const handleKeepers = []\n\n      nodesId.forEach((id) => {\n        const cache = this.store.get(id)\n\n        if (!cache) {\n          return\n        }\n\n        const keeper = this.keepers.get(id)\n        handleKeepers.push(keeper)\n      })\n\n      if (handleKeepers.length === 0) {\n        resolve(false)\n        return\n      }\n\n      Promise.all(\n        handleKeepers.map((keeper) => run(keeper, type, ...rest))\n      ).then((responses) => resolve(responses.every(Boolean)))\n    })\n\n  clear = (...rest) =>\n    this.handleNodes(\n      this.getCachingNodes().map(({ id }) => id),\n      HANDLE_TYPE_DROP,\n      ...rest\n    )\n\n  getCache = (id) => this.store.get(id)\n  getNode = (id) => this.nodes.get(id)\n  getCachingNodes = () => [...this.nodes.values()]\n\n  // 静态化节点上下文内容，防止重复渲染\n  helpers = {\n    keep: this.keep,\n    update: this.update,\n    drop: this.drop,\n    dropScope: this.dropScope,\n    dropById: this.dropById,\n    dropScopeByIds: this.dropScopeByIds,\n    refresh: this.refresh,\n    refreshScope: this.refreshScope,\n    refreshById: this.refreshById,\n    refreshScopeByIds: this.refreshScopeByIds,\n    getScopeIds: this.getScopeIds,\n    clear: this.clear,\n    getCache: this.getCache,\n    getNode: this.getNode,\n    getCachingNodes: this.getCachingNodes,\n  }\n\n  render() {\n    const { children = null } = this.props\n\n    return (\n      <AliveScopeProvider value={this.helpers}>\n        {children}\n        <div style={{ display: 'none' }}>\n          {[...this.nodes.values()].map(({ children, ...props }) => (\n            <Keeper\n              key={props.id}\n              {...props}\n              scope={this}\n              store={this.store}\n              keepers={this.keepers}\n              ref={(keeper) => {\n                this.keepers.set(props.id, keeper)\n              }}\n            >\n              {children}\n            </Keeper>\n          ))}\n        </div>\n      </AliveScopeProvider>\n    )\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, { forwardRef, useContext } from 'react'\nimport hoistStatics from 'hoist-non-react-statics'\nimport { get, isFunction, isUndefined } from 'szfe-tools'\n\nimport { Acceptor } from './Bridge'\nimport NodeKey from './NodeKey'\nimport { AliveScopeConsumer, useScopeContext } from './context'\n\nfunction controllerCherryPick(controller) {\n  const {\n    drop,\n    dropScope,\n    refresh,\n    refreshScope,\n    clear,\n    getCachingNodes,\n    dropById,\n    dropScopeByIds,\n    refreshById,\n    refreshScopeByIds,\n  } = controller\n\n  return {\n    drop,\n    dropScope,\n    refresh,\n    refreshScope,\n    clear,\n    getCachingNodes,\n    dropById,\n    dropScopeByIds,\n    refreshById,\n    refreshScopeByIds,\n  }\n}\n\nexport const expandKeepAlive = (KeepAlive) => {\n  const renderContent = ({ idPrefix, helpers, props, forwardedRef }) => {\n    const isOutsideAliveScope = isUndefined(helpers)\n\n    if (isOutsideAliveScope) {\n      console.error('You should not use <KeepAlive /> outside a <AliveScope>')\n    }\n\n    return isOutsideAliveScope ? (\n      get(props, 'children', null)\n    ) : (\n      <NodeKey prefix={idPrefix} key={props._nk} manualKey={props.cacheKey}>\n        {(nkId) => {\n          const id = props.cacheKey || nkId\n\n          return (\n            <Acceptor key={id} id={id}>\n              {(bridgeProps) => (\n                <KeepAlive\n                  key={id}\n                  {...props}\n                  {...bridgeProps}\n                  id={id}\n                  ref={forwardedRef}\n                  _helpers={helpers}\n                />\n              )}\n            </Acceptor>\n          )\n        }}\n      </NodeKey>\n    )\n  }\n  const HookExpand = ({ id: idPrefix, forwardedRef, ...props }) =>\n    renderContent({ idPrefix, helpers: useScopeContext(), props, forwardedRef })\n\n  const WithExpand = ({ id: idPrefix, forwardedRef, ...props }) => (\n    <AliveScopeConsumer>\n      {(helpers) => renderContent({ idPrefix, helpers, props, forwardedRef })}\n    </AliveScopeConsumer>\n  )\n\n  const ExpandKeepAlive = isFunction(useContext) ? HookExpand : WithExpand\n\n  if (isFunction(forwardRef)) {\n    const ForwardedRefHOC = forwardRef((props, ref) => (\n      <ExpandKeepAlive {...props} forwardedRef={ref} />\n    ))\n\n    return hoistStatics(ForwardedRefHOC, KeepAlive)\n  } else {\n    return hoistStatics(ExpandKeepAlive, KeepAlive)\n  }\n}\n\nconst withAliveScope = (WrappedComponent) => {\n  const renderContent = ({ helpers, props, forwardedRef }) => (\n    <WrappedComponent {...props} {...helpers} ref={forwardedRef} />\n  )\n\n  const HookScope = ({ forwardedRef, ...props }) =>\n    renderContent({\n      helpers: controllerCherryPick(useScopeContext() || {}),\n      props,\n      forwardedRef,\n    })\n\n  const WithScope = ({ forwardedRef, ...props }) => (\n    <AliveScopeConsumer>\n      {(controller = {}) =>\n        renderContent({\n          helpers: controllerCherryPick(controller),\n          props,\n          forwardedRef,\n        })\n      }\n    </AliveScopeConsumer>\n  )\n\n  const HOCWithAliveScope = isFunction(useContext) ? HookScope : WithScope\n\n  if (isFunction(forwardRef)) {\n    const ForwardedRefHOC = forwardRef((props, ref) => (\n      <HOCWithAliveScope {...props} forwardedRef={ref} />\n    ))\n\n    return hoistStatics(ForwardedRefHOC, WrappedComponent)\n  } else {\n    return hoistStatics(HOCWithAliveScope, WrappedComponent)\n  }\n}\n\nexport const useAliveController = () => {\n  if (!isFunction(useContext)) {\n    return {}\n  }\n\n  const ctxValue = useScopeContext()\n\n  if (!ctxValue) {\n    return {}\n  }\n\n  return controllerCherryPick(ctxValue)\n}\n\nexport default withAliveScope\n","import {\n  globalThis as root,\n  get,\n  run,\n  value,\n  isFunction,\n  isExist,\n  flatten,\n} from 'szfe-tools'\n\nfunction isScrollableNode(node = {}) {\n  if (!isExist(node)) {\n    return false\n  }\n\n  return (\n    node.scrollWidth > node.clientWidth || node.scrollHeight > node.clientHeight\n  )\n}\n\nfunction getScrollableNodes(from) {\n  if (!isFunction(get(root, 'document.querySelectorAll'))) {\n    return []\n  }\n\n  return [...value(run(from, 'querySelectorAll', '*'), []), from].filter(\n    isScrollableNode\n  )\n}\n\nexport default function saveScrollPosition(from) {\n  const nodes = [...new Set([...flatten(from.map(getScrollableNodes))])]\n\n  const saver = nodes.map((node) => [\n    node,\n    {\n      x: node.scrollLeft,\n      y: node.scrollTop,\n    },\n  ])\n\n  return function revert() {\n    saver.forEach(([node, { x, y }]) => {\n      node.scrollLeft = x\n      node.scrollTop = y\n    })\n  }\n}\n","import React, { Component } from 'react'\nimport {\n  value,\n  get,\n  run,\n  globalThis as root,\n  nextTick,\n  isFunction,\n  isArray,\n  debounce,\n  flatten,\n} from 'szfe-tools'\n\nimport { expandKeepAlive } from './withAliveScope'\nimport {\n  LIFECYCLE_ACTIVATE,\n  LIFECYCLE_UNACTIVATE,\n  withActivation,\n} from './lifecycles'\nimport saveScrollPosition from '../helpers/saveScrollPosition'\n\nconst body = get(root, 'document.body')\nconst screenScrollingElement = get(\n  root,\n  'document.scrollingElement',\n  get(root, 'document.documentElement', {})\n)\n\nconst parseWhenResult = (res) => {\n  if (isArray(res)) {\n    return res\n  }\n\n  return [res]\n}\n\nclass KeepAlive extends Component {\n  static defaultProps = {\n    saveScrollPosition: true,\n  }\n\n  id = null // 用作 Keeper 识别 KeepAlive\n  isKeepAlive = true // 用作 Keeper 识别 KeepAlive\n  cached = false\n  constructor(props) {\n    super(props)\n    this.id = props.id\n    this.init()\n\n    // 继承响应父级 KeepAlive 的生命周期\n    ;[LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].forEach((lifecycleName) => {\n      this[lifecycleName] = () => {\n        const { id, _helpers } = this.props\n        const cache = _helpers.getCache(id)\n        const node = _helpers.getNode(id)\n        if (node && lifecycleName === LIFECYCLE_ACTIVATE) {\n          node.updateTime = Date.now()\n        }\n\n        const cached = lifecycleName === LIFECYCLE_UNACTIVATE\n\n        // 若组件即将卸载则不再触发缓存生命周期\n        if (!cache || cache.willDrop) {\n          // 若组件在父 KeepAlive 缓存期间被卸载，后续恢复后需重新触发 init\n          if (this.cached && !cached) {\n            this.init()\n          }\n          return\n        }\n\n        run(cache, lifecycleName)\n        cache.cached = cached\n        this.cached = cached\n      }\n    })\n  }\n\n  // DOM 操作将实际内容插入占位元素\n  inject = (didActivate = true) => {\n    const { id, saveScrollPosition, _helpers } = this.props\n    const cache = _helpers.getCache(id)\n    // DOM 操作有风险，try catch 护体\n    try {\n      // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n      // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n      // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n      // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n      // this.parentNode = this.placeholder.parentNode\n      // cache.nodes.forEach(node => {\n      //   this.parentNode.insertBefore(node, this.placeholder)\n      // })\n      // this.parentNode.removeChild(this.placeholder)\n      // 将 AliveScopeProvider 中的渲染内容通过 dom 操作置回当前 KeepAlive\n      cache.nodes.forEach((node) => {\n        this.placeholder.appendChild(node)\n      })\n\n      if (didActivate && saveScrollPosition) {\n        // 恢复该节点下各可滚动元素的滚动位置\n        run(cache.revertScrollPos)\n      }\n    } catch (error) {\n      // console.error(error)\n    }\n  }\n\n  // DOM 操作将实际内容移出占位元素\n  eject = (willUnactivate = true) => {\n    const { id, _helpers } = this.props\n    const cache = _helpers.getCache(id)\n    const nodesNeedToSaveScrollPosition = flatten(\n      flatten([this.props.saveScrollPosition]).map((flag) => {\n        if (flag === true) {\n          return cache.nodes\n        }\n\n        if (flag === 'screen') {\n          return [screenScrollingElement, body]\n        }\n\n        return [...value(run(root, 'document.querySelectorAll', flag), [])]\n      })\n    ).filter(Boolean)\n\n    // DOM 操作有风险，try catch 护体\n    try {\n      if (willUnactivate && nodesNeedToSaveScrollPosition.length > 0) {\n        // 保存该节点下各可滚动元素的滚动位置\n        cache.revertScrollPos = saveScrollPosition(\n          nodesNeedToSaveScrollPosition\n        )\n      }\n\n      // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n      // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n      // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n      // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n      // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n      // cache.nodes.forEach(node => {\n      //   if (willUnactivate) {\n      //     this.parentNode.removeChild(node)\n      //   } else {\n      //     cache.wrapper.appendChild(node)\n      //   }\n      // })\n      // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n      // 将 KeepAlive 中的节点恢复为原先的占位节点，保证卸载操作正常进行\n      cache.nodes.forEach((node) => {\n        if (willUnactivate) {\n          this.placeholder.removeChild(node)\n        } else {\n          cache.wrapper.appendChild(node)\n        }\n      })\n    } catch (error) {\n      // console.error(error)\n    }\n  }\n\n  refresh = () => {\n    const { _helpers, id } = this.props\n    return _helpers.refreshById(id)\n  }\n\n  drop = (config) => {\n    const { _helpers, id } = this.props\n    return _helpers.dropById(id, config)\n  }\n\n  init = () => {\n    const { _helpers, id, children, ...rest } = this.props\n\n    // 将 children 渲染至 AliveScopeProvider 中\n    _helpers\n      .keep(id, {\n        children,\n        getInstance: () => this,\n        ...rest,\n      })\n      .then((cache) => {\n        // fix #22\n        if (!cache) {\n          return\n        }\n\n        this.inject()\n\n        // 触发 didActivate 生命周期\n        if (cache.inited) {\n          run(this, LIFECYCLE_ACTIVATE)\n        } else {\n          cache.inited = true\n        }\n        this.cached = false\n      })\n  }\n\n  update = ({ _helpers, id, name, ...rest } = {}) => {\n    if (!_helpers || this.cached) {\n      return\n    }\n\n    // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n    // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n    // // 对应 Keeper 处 componentDidUpdate 也注释起来不使用\n    // this.eject(false)\n    _helpers.update(id, {\n      name,\n      getInstance: () => this,\n      ...rest,\n    })\n    // this.inject(false)\n  }\n\n  // 利用 shouldComponentUpdate 提前触发组件更新\n  shouldComponentUpdate(nextProps) {\n    this.update(nextProps)\n\n    return false\n  }\n\n  // 组件卸载时重置 dom 状态，保证 react dom 操作正常进行，并触发 unactivate 生命周期\n  componentWillUnmount() {\n    const { id, _helpers, when: calcWhen = true } = this.props\n    const cache = _helpers.getCache(id)\n    const [when, isScope] = parseWhenResult(run(calcWhen))\n\n    if (!cache) {\n      return\n    }\n\n    this.eject()\n    delete cache.getInstance\n\n    if (!when) {\n      if (isScope) {\n        const needToDrop = [\n          cache,\n          ..._helpers.getScopeIds([id]).map((id) => _helpers.getCache(id)),\n        ].filter(Boolean)\n\n        needToDrop.forEach((cache) => {\n          cache.willDrop = true\n        })\n        nextTick(() => _helpers.dropScopeByIds([id]))\n      } else {\n        cache.willDrop = true\n        nextTick(() => _helpers.dropById(id))\n      }\n    }\n\n    // 触发 willUnactivate 生命周期\n    run(this, LIFECYCLE_UNACTIVATE)\n  }\n\n  render() {\n    const { wrapperProps = {} } = this.props || {}\n    return (\n      <div\n        {...wrapperProps}\n        key='keep-alive-placeholder'\n        nodeKeyIgnore\n        className={`ka-wrapper ${wrapperProps.className || ''}`}\n        ref={(node) => {\n          this.placeholder = node\n        }}\n      />\n    )\n  }\n}\n\n// 兼容 SSR 服务端渲染\nfunction SSRKeepAlive({ children }) {\n  const { wrapperProps = {}, contentProps = {} } = this.props || {}\n  return (\n    <div\n      {...wrapperProps}\n      key='keep-alive-placeholder'\n      nodeKeyIgnore\n      className={`ka-wrapper ${wrapperProps.className || ''}`}\n    >\n      <div\n        {...contentProps}\n        key='keeper-container'\n        nodeKeyIgnore\n        className={`ka-content ${contentProps.className || ''}`}\n      >\n        {children}\n      </div>\n    </div>\n  )\n}\n\nexport default isFunction(get(root, 'document.getElementById'))\n  ? expandKeepAlive(withActivation(KeepAlive))\n  : SSRKeepAlive\n"],"names":["isRegExp","val","RegExp","MAX_SIGNED_31_BIT_INT","objectIs","x","y","createEventEmitter","value","handlers","on","handler","push","off","filter","h","get","set","newValue","changedBits","forEach","onlyChild","children","Array","isArray","createReactContext","defaultValue","calculateChangedBits","contextProp","_random","Provider","_Component","_this","_classCallCheck","_len","arguments","length","args","_key","_callSuper","concat","_defineProperty","props","_inherits","_createClass","key","getChildContext","emitter","componentWillReceiveProps","nextProps","oldValue","render","Component","Consumer","_Component2","_this2","_len2","_key2","getValue","observedBits","setState","undefined","componentDidMount","context","onUpdate","componentWillUnmount","state","React","createContext","aliveScopeContext","AliveScopeProvider","AliveScopeConsumer","aliveNodeContext","AliveNodeProvider","AliveNodeConsumer","eventBus","_EventBus","FakeScopeProvider","currentContextValue","shouldComponentUpdate","emit","FakeScopeConsumer","_PureComponent","_debounce","nextContextValue","updateListener","_run","PureComponent","_filehash","useScopeContext","_isFunction","useContext","scopeReactContext","_useState","useState","_useState2","_slicedToArray","setContext","useEffect","fakeContextEventBus","_ref","_objectWithoutProperties","_excluded","createElement","AliveScopeReactProvider","_extends","_nk","_ref2","AliveScopeReactConsumer","reactContext","Suspender","_this$props","freeze","promiseCache","promise","Promise","resolve","Fragment","Freeze","_ref$placeholder","placeholder","Suspense","fallback","fixedContext","updateListenerCache","Map","fixContext","_memoize","ctx","_isExist","includes","ctxValue","setTimeout","tryFixCtx","type","_get","override","configs","_ref3","_toArray","host","methods","slice","method","originMethod","bind","_isString","apply","_overridden","autoFixContext","err","console","warn","ProviderBridge","ctxValues","_possibleConstructorReturn","_ctxValues","_ctxValues$","unmount","propCtxValues","Boolean","_ctxValues2","restValues","nextChildren","_isUndefined","ConsumerWrapper","id","fn","ctxInfo","updator","_objectSpread","prevValue","shouldUpdate","_this$props2","renderWrapper","renderContent","ctx$$","_toConsumableArray","fixedContextSnapshot","RecursiveConsumerBridge","renderChildren","reduce","isSupported","lazy","SusNotSupported","Lazy","FallbackListener","SuspenseBridge","sus$$","onStart","onSuspenseStart","onEnd","onSuspenseEnd","LazyBridge","suspense","ErrorBoundaryBridge","componentDidCatch","error","throwError","error$$","ErrorThrower","cb","Bridge","bridgeProps","Acceptor","ConsumerBridge","LIFECYCLE_ACTIVATE","LIFECYCLE_UNACTIVATE","withActivation","WrappedComponent","HOC","drop","forwardedRef","attach","ref","every","lifecycleName","_isObject","current","prototype","_componentDidMount","_this3","_nextTick","call","forwardRef","ForwardedRefHOC","hoistStatics","useActivation","funcName","func","useRef","some","_useRef","useActivate","useUnactivate","ReactFreeze","Keeper","rest","nextState","callback","unmounted","listeners","isKeepAlive","store","cache","aliveNodesId","Set","_ref2$delay","delay","_ref2$refreshIfDropFa","refreshIfDropFailed","timeout","scope","clearTimeout","willDrop","nodes","helpers","smartForceUpdate","canDrop","refresh","then","result","canRefresh","safeSetState","Math","random","_this$props3","node","wrapper","has","e","inited","cached","_this$props4","keepers","appendChild","freezeTimeout","listener","reverse","_ref4","flushSync","_this4","_this$props5","_this$props5$autoFree","autoFreeze","_this$props5$contentP","contentProps","_this$state","className","contextValue","Children","map","child","idx","cloneElement","HANDLE_TYPE_DROP","HANDLE_TYPE_REFRESH","AliveScope","forceUpdate","updateCallbackList","debouncedForceUpdate","params","keeper","isNew","now","Date","createTime","updateTime","update","name","getCachingNodes","test","ids","getCachingNodesId","getCache","size","_flatten","handleNodes","_len3","_key3","getScopeIds","_len4","_key4","getCachingNodesByName","_this5","_len5","_key5","dropScopeByIds","_this6","_len6","_key6","_this7","_len7","_key7","_this8","_len8","_key8","_this9","_len9","_key9","refreshScopeByIds","nodesId","_len0","_key0","handleKeepers","all","responses","_this0","_len1","_key1","values","keep","dropScope","dropById","refreshScope","refreshById","clear","getNode","_this1","_this$props$children","style","display","controllerCherryPick","controller","expandKeepAlive","KeepAlive","idPrefix","isOutsideAliveScope","NodeKey","prefix","manualKey","cacheKey","nkId","_helpers","HookExpand","WithExpand","_excluded2","ExpandKeepAlive","withAliveScope","HookScope","_ref5","_excluded3","WithScope","_ref6","_excluded4","HOCWithAliveScope","useAliveController","isScrollableNode","scrollWidth","clientWidth","scrollHeight","clientHeight","getScrollableNodes","from","_globalThis","_value","saveScrollPosition","saver","scrollLeft","scrollTop","revert","_ref2$","body","screenScrollingElement","parseWhenResult","res","_isArray","didActivate","revertScrollPos","willUnactivate","nodesNeedToSaveScrollPosition","flag","removeChild","config","getInstance","inject","init","_this$props6","_this$props7","_this$props7$when","when","calcWhen","_parseWhenResult","_parseWhenResult2","isScope","eject","needToDrop","_ref2$wrapperProps","wrapperProps","SSRKeepAlive","_ref4$wrapperProps","_ref4$contentProps"],"mappings":"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"}